'use strict';var d=!0,m=null,r=!1,aa=2,ba=3,ca=4,ea=5,fa=6,t=0,ga=1,u=2,ha=3,ia=4,ja=0,ma=1,na=0,oa=1,pa=2,qa=3,ra=4,sa=5,ta=6,ua=7,v=[];v.ja=4;v.g=0;v.z=0;v.Oa=128;v.c=0;v.Ca=4;v.B=4;v.P=2;v.Ba=8;v.ba=8;v.b=[];v.b.q=9;v.b.r=2;v.b.J=23;v.b.K=32;v.F=ja;v.A=-1;v.U=0;v.d=0;v.w=0;v.V=0;v.a=[];v.a.pa=m;v.a.T=m;v.a.ga=m;v.a.ha=m;v.a.qa=m;v.a.ra=m;v.a.fa=m;v.a.oa=m;var w=0,va=1,y=2,wa=3,z,A,B,C,D,E,G,xa,ya,za=[],Aa,Ba,Ca,Da,Ea,Fa,H,J,Ga,K,L,N,O,Q,Ha,R,S,T,Ia,Ja;
function La(a){var c=0;65<=a&&90>=a?c=a-65:97<=a&&122>=a?c=a-71:48<=a&&57>=a?c=a+4:43==a?c=62:47==a&&(c=63);return c}function Ma(a){var c=3*a.length/4;"="==a.charAt(a.length-1)&&(c-=1,"="==a.charAt(a.length-2)&&(c-=1));for(var e=new Uint8ClampedArray(c),b=0,f=0;f<c;b+=4,f+=3){var g=La(a.charCodeAt(b+1)),k=La(a.charCodeAt(b+2)),s=La(a.charCodeAt(b+3));e[f]=(La(a.charCodeAt(b))<<2|g>>>4)&255;e[f+1]=(g<<4|k>>>2)&255;e[f+2]=(k<<6|s)&255}return e}
function Na(a,c){var e=c;if(a.ta==d)for(;0<e;){var b=e;0<a.u&&(b>a.u&&(b=a.u),a.u-=b);e-=b;0==a.u&&(b=a.S[a.N],a.aa=b.Aa,a.u=b.La,a.N+=1,a.N>=a.S.length&&(a.ia==r?a.N=0:(a.ta=r,e=0,a.Y!=m&&a.Y(a))))}}function Oa(a){for(var c=Ca.length,e=0;e<c;e++){var b=Ca[e];Na(b,a)}c=Da.length;for(e=0;e<c;e++)b=Da[e],Na(b,a)}function Pa(a,c,e){var b={};b.S=a.S;b.aa=b.S[0].Aa;b.u=0;b.N=0;b.ia=a.ia;b.Y=a.Y;b.za=c;b.ca=e;b.ta=d;return b}
function Qa(a){for(var c=Da,e=0,b=c.length;e<b;)c[e].ca==a?(c.splice(e,1),--b):++e}var Ra={mushroom_switch_activated:function(a){var c=a.ca;a=a.za;Qa(c);N[a].L[c]=m;N[a].k[c]=Ea.mushroom_switch_finished;R[c>>>3]|=1<<(c&7);var c=G.na[c],e=c+G.s,b=Ea.door_up,f=Ea.door_down,g=Pa(Ba[b],a,c),k=Pa(Ba[f],a,e);N[a].L[c]=g;N[a].L[e]=k;Da.push(g);Da.push(k);N[a].k[c]=b;N[a].k[e]=f},door_open:function(a){var c=a.ca;a=a.za;Qa(c);N[a].L[c]=m;N[a].k[c]=0;R[c>>>3]|=1<<(c&7)}};
function Sa(a,c){for(var e=a+G.s*c,b=0!=(R[e>>>3]&1<<(e&7)),f=N.length,g=0;g<f;g++){var k=N[g].L[e];k!=m&&N[g].k[e]!=k.aa&&(N[g].k[e]=k.aa,b=d)}if(b==d){var b=Aa[N[1].k[e]],f=Math.floor(a/D)+Q*Math.floor(c/E),g=a%D,k=c%E,s=O[f][1][1];O[f][0][1].putImageData(Aa[N[0].k[e]],g*z,k*A);s.putImageData(b,g*z,k*A);R[e>>>3]&=~(1<<(e&7))}}
function Ta(){var a=Math.floor(S/(z*D)),c=Math.floor(T/(A*E)),e=Math.ceil((S+B*z)/(z*D)),b=Math.ceil((T+C*A)/(A*E)),f=S%(z*D),g=T%(A*E),k=B*z,s=C*A,p=D*z,q=E*A,l,h,n,x,P,F;K.setTransform(1,0,0,1,0,0);for(var da=N.length,I=0;I<da;I++){var M=N[I];h=g;x=q-h;F=0;for(var ka=c;ka<b;ka++){l=f;n=p-l;P=0;for(var la=a;la<e;la++)K.drawImage(O[la+Q*ka][I][0],l,h,n,x,P,F,n,x),P+=n,l=0,n=p,P+n>k&&(n=k-P);F+=x;h=0;x=q;F+x>s&&(x=s-F)}l=M.ea;h=l.length;for(n=0;n<h;n++)x=l[n],x.M==d&&K.drawImage(x.l,x.j-S-v.b.q-(v.b.J-
v.b.q)/2,x.f-T-v.b.r-(v.b.K-v.b.r)/2)}K.translate(-S,-T);K.scale(z,A);K.drawImage(L.l,0,0);K.setTransform(1,0,0,1,0,0)}function Ua(){var a=H.j,c=H.f;v.g==ha?c=v.A:v.g==u&&c<=v.A&&(c=v.A);var a=a-B*z/2,c=c-C*A/2,e=(G.s-B)*z-1,b=(G.Z-C)*A-1;0>a?a=0:a>e&&(a=e);0>c?c=0:c>b&&(c=b);return[a,c]}function Va(){for(var a=Math.floor(S/z),c=Math.floor(T/A),e=a+B+1,b=c+C+1;c<b;c++)for(var f=a;f<e;f++)Sa(f,c);Ta()}function Wa(){J.M=d;J.j=H.j;J.f=H.f;H.m=0;v.e=ua;H.h=v.a.oa;H.i=1;v.g=ia}
var Xa={gold:function(a,c,e){var b;switch(a){case w:case va:case y:N[c].k[e]=0;R[e>>>3]|=1<<(e&7);a=G.la[e];N[c].k[a]=Ea.gold_target;R[a>>>3]|=1<<(a&7);b=0;break;case wa:b=0}return b},snake:function(a){var c;switch(a){case w:case va:case y:Wa();c=0;break;case wa:c=0}return c},spears:function(a){var c;switch(a){case w:case va:case y:Wa();c=0;break;case wa:c=0}return c},mushroom_switch_activate:function(a,c,e){var b;if(v.g==ha&&v.F==ma||v.g==u){var f=Ea.mushroom_switch_animation,g=Pa(Ba[f],c,e);N[c].L[e]=
g;Da.push(g);N[c].k[e]=f}switch(a){case w:case y:b=0;break;case va:case wa:b=1}return b}};
function U(a,c,e,b){for(var f=0,g=0,k=0;k<e.length;k++){for(var s=e[k],p=Math.floor((s[0]-a)/z),q=Math.ceil((s[0]+a)/z),l=Math.ceil((s[1]+c)/A),h=Math.floor((s[1]-c)/A);h<l;h++)for(var n=p;n<q;n++)for(var x=N.length,P=0;P<x;P++){var F=0,da=n+G.s*h,I=G.sa[N[P].k[da]];if(I!=m&&(b==va&&I.Ha==d||b==y&&I.Ia==d||b==w&&I.Ka==d||b==wa&&I.Ja==d))for(F=0;F<I.ua.length;F++){var M=I.ua[F];if("R"==M.type){var ka=(M.J-M.q)/2,la=(M.K-M.r)/2,Ka=M.q+ka,M=M.r+la,Ka=Ka+n*z,M=M+h*A,M=Math.abs(M-s[1]);if(Math.abs(Ka-
s[0])<a+ka&&M<c+la){F=1;I=I.action;I!=m&&(F=I(b,P,da));g|=F;break}}}}if(0==g)f+=1;else break}return f}function V(a,c){var e=[];if(0!=c){var b=Math.abs(c),f=a,g,k;0>c?(k=f-Math.floor(f),g=-1):(k=Math.ceil(f)-f,g=1);if(b>=k){0<k&&(f+=g*k,e.push(f),b-=k);for(;1<=b;)f+=g,e.push(f),b-=1}0!=b&&e.push(f+g*b)}return e}
function Ya(a,c,e){var b=0,f=(v.b.J-v.b.q)/2;c+=(v.b.K-v.b.r)/2;var g=V(c,e),k=g.length;e=Array(k);for(var s=0;s<k;s++)e[s]=[a,g[s]];a=U(f,0.5,e,wa);0<a&&(a=U(f,0.5,e,va),0<a&&(b=e[a-1][1]-c));return b}function Za(a,c){if(c==d)if(a.D==m){var e=a.W-a.t,b=a.da-a.C;L.n.clearRect(a.t,a.C,e,b)}else e=a.D.l,L.n.globalCompositeOperation="destination-out",L.n.drawImage(e,a.t,a.C),L.n.globalCompositeOperation="source-over";else e=a.W-a.t,b=a.da-a.C,L.n.fillRect(a.t,a.C,e,b)}
function $a(a){for(var c=Fa.length,e=0;e<c;e++){var b=Fa[e];if(b.M==d)for(var f=a;0<f;){var g=f;b.o<b.i&&(b.o+g>b.i&&(g=b.i-b.o),b.o+=g);f-=g;b.o>=b.i&&(b.o=0,g=b.m+1,g>=b.h.length&&(g=0),b.m=g,g=b.h[g],g!=b.I&&(b.I=g,b.n.putImageData(b.X[g],0,0)))}}}
function ab(a,c){if(v.g==ga){var e=v.Ba*a,e=Ya(H.j,H.f,e);if(0!=e)H.f+=e,v.g=u,v.z=e;else if(0!=(c&W))v.g=ha,v.F=ja,v.U=0,v.d=0,v.w=0,v.V=0,v.A=H.f,0!=(c&X)?(v.U=-v.Ca,v.e=ra,H.h=v.a.ga):0!=(c&Y)?(v.U=v.Ca,v.e=sa,H.h=v.a.ha):v.e==na||v.e==pa||v.e==ra?(v.e=ra,H.h=v.a.ga):(v.e=sa,H.h=v.a.ha),H.i=1;else if(0==(c&(X|Y|bb|cb)))if(v.c=0,H.m=0,v.e==pa||v.e==ra)v.e=na,H.h=v.a.pa,H.i=1;else{if(v.e==qa||v.e==sa)v.e=oa,H.h=v.a.T,H.i=1}else{var b=H.j,f=H.f,e=b,g=f,k=(v.b.J-v.b.q)/2,s=(v.b.K-v.b.r)/2;if(0!=(c&
X)){v.c<v.B&&(v.c+=1*a);v.c>v.B&&(v.c=v.B);for(var b=V(b,-v.c*a),p=b.length,q=Array(p),l=0;l<p;l++)q[l]=[b[l],f];var h=U(k,s,q,w);if(0<h)e=q[h-1][0],g=q[h-1][1];else{for(var h=V(f-v.ba-1,v.ba),n=h.length,q=Array(p*n),f=0;f<n;f++)for(l=0;l<p;l++)q[f*p+l]=[b[l],h[f]];h=U(k,s,q,w);0<h&&(e=q[h-1][0],g=q[h-1][1])}v.e!=pa&&(v.e=pa,H.h=v.a.qa,H.m=0);H.i=1+v.B-v.c}else if(0!=(c&Y)){v.c<v.B&&(v.c+=1*a);v.c>v.B&&(v.c=v.B);b=V(b,v.c*a);p=b.length;q=Array(p);for(l=0;l<p;l++)q[l]=[b[l],f];h=U(k,s,q,w);if(0<h)e=
q[h-1][0],g=q[h-1][1];else{h=V(f-v.ba-1,v.ba);n=h.length;q=Array(p*n);for(f=0;f<n;f++)for(l=0;l<p;l++)q[f*p+l]=[b[l],h[f]];h=U(k,s,q,w);0<h&&(e=q[h-1][0],g=q[h-1][1])}v.e!=qa&&(v.e=qa,H.h=v.a.ra,H.m=0);H.i=1+v.B-v.c}else if(0!=(c&bb)){v.c<v.P&&(v.c+=1*a);v.c>v.P&&(v.c=v.P);h=V(f,-v.c*a);n=h.length;q=Array(n);for(l=0;l<n;l++)q[l]=[b,h[l]];h=U(k,s,q,w);0<h&&(e=q[h-1][0],g=q[h-1][1],k=Ya(e,g,f-g),0<k&&(g+=k));v.e!=ta&&(v.e=ta,H.h=v.a.fa,H.m=0,H.i=3)}else if(0!=(c&cb)){v.c<v.P&&(v.c+=1*a);v.c>v.P&&(v.c=
v.P);h=V(f,v.c*a);n=h.length;q=Array(n);for(l=0;l<n;l++)q[l]=[b,h[l]];h=U(k,s,q,w);0<h&&(e=q[h-1][0],g=q[h-1][1]);v.e!=ta&&(v.e=ta,H.h=v.a.fa,H.m=0,H.i=3)}H.j=e;H.f=g}}else if(v.g==u)e=v.Ba*a,e=Ya(H.j,H.f,e),0!=e?(H.f+=e,v.z+=e):(v.A=-1,v.z>v.Oa?Wa():v.g=ga);else if(v.g==ha){e=H.j;g=H.f;k=(v.b.J-v.b.q)/2;s=(v.b.K-v.b.r)/2;q=a;if(v.F==ja)if(0!=(c&W))if(f=q,12<v.d+f&&(f=12-v.d),v.d+=f,q-=f,b=v.U*f,f=v.A-(2304-(4*v.d-48)*(4*v.d-48))/48-g,0!=f){b=-b/f;p=V(g,f);h=p.length;f=Array(h);for(n=0;n<h;n++){var l=
p[n],x=g-l,x=e+x*b;f[n]=[x,l]}p=U(k,s,f,y);p==f.length?(b=f[p-1][0],f=f[p-1][1],12<=v.d&&(v.F=ma,v.w=v.d+4,v.d=0,v.V=0,v.z=0)):(0<p?(b=f[p-1][0],f=f[p-1][1]):(b=e,f=g),v.g=u,v.z=0)}else b=e,f=g,12<=v.d&&(v.F=ma,v.w=v.d+4,v.d=0,v.V=0,v.z=0);else b=e,f=g,v.F=ma,v.w=v.d+4,v.d=0,v.V=48-(v.A-g),v.z=0;if(v.F==ma&&0<q)if(0==Ya(e,g,1))b=e,f=g,v.g=ga;else if(f=q,v.d+f>v.w&&(f=v.w-v.d),v.d+=f,b=v.U*f,f=v.A-(2304-4*v.d*4*v.d)/48+v.V-g,0!=f){b=-b/f;p=V(g,f);h=p.length;f=Array(h);for(n=0;n<h;n++)l=p[n],x=g-l,
x=e+x*b,f[n]=[x,l];p=U(k,s,f,y);p==f.length?(b=f[p-1][0],f=f[p-1][1],v.d>=v.w&&(v.g=u)):(0<p?(b=f[p-1][0],f=f[p-1][1]):(b=e,f=g),v.g=ga)}else b=e,f=g,v.d>=v.w&&(v.g=u);H.j=b;H.f=f}else v.g==ia&&(e=J.f-4*a,e<T-A?1<v.ja?(v.ja--,db()):(t=ea,K.fillRect(0,0,B*z,C*A),K.strokeText("Game over!",100,100)):J.f=e)}
function eb(){t!=ca&&window.requestAnimationFrame(eb);var a=Date.now();if(0!=Ja){var c=(a-Ja)/40;if(t==ba)if(Ia==d){t=ca;for(c=0;10>c;c++)K.strokeText("PAUSED",160+16*c,160+16*c);Ia=r}else{ab(c,Z);var e=Math.floor(H.j/z),b=Math.floor(H.f/A),f=e+G.s*b;if(f==G.Ma)t=fa;else for(var g in G.ma)g==f&&(G.R[0].x=e,G.R[0].y=b);$a(c);e=Ua();f=e[0]-S;b=e[1]-T;g=C*A;f>B*z||b>g?(f=e[0],b=e[1]):(-8>f?f=-8:8<f&&(f=8),-8>b?b=-8:8<b&&(b=8),f=S+f,b=T+b);e=f;if(e!=S||b!=T){var f=Math.floor(T/(E*A)),k=Math.floor(e/(D*
z)),s=Math.floor(b/(E*A)),p=k+Math.ceil((B+1)/D),q=s+Math.ceil((C+1)/E);if(Math.floor(S/(D*z))!=k||f!=s){f=[];g=[];for(var l=0;l<Q;l++)for(var h=0;h<Q;h++)O[h+l*Q]!=m?(h<k||h>=p||l<s||l>=q)&&f.push([h,l]):h>=k&&(h<p&&l>=s&&l<q)&&g.push([h,l]);if(f.length==g.length)for(var n,k=0;k<f.length;k++){l=f[k][0]+f[k][1]*Q;h=g[k][0]+g[k][1]*Q;O[h]=O[l];O[l]=m;s=g[k][0]*D;p=s+D;l=g[k][1]*E;for(q=l+E;l<q;l++)for(h=s;h<p;h++)n=h+G.s*l,R[n>>>3]|=1<<(n&7)}}S=e;T=b}e=[];b=[];f=r;g=Math.floor(H.j/z);l=Math.floor(H.f/
A);for(h=0;h<ya.length;h++)k=ya[h],g>=k.t&&(g<=k.W&&l>=k.C&&l<=k.da)&&(s=r,k.D==m?s=d:(p=g-k.t,0!=(k.D.Ga[Math.floor(p/8)+(l-k.C)*Math.ceil((k.W-k.t)/8)]&1<<(p&7))&&(s=d)),s==d&&(-1==za.indexOf(k)&&(f=d),e.push(k)));for(h=0;h<za.length;h++)k=za[h],-1==e.indexOf(k)&&(f=d,b.push(k));if(f==d){za=e;for(h=0;h<b.length;h++)Za(b[h],r);for(h=0;h<za.length;h++)Za(za[h],d)}Oa(c);Va()}else if(t==ea)for(c=0;10>c;c++)K.strokeText("GAME OVER",160+16*c,160+16*c);else t==fa&&(ab(c,X),$a(c),Oa(c),Va(),K.strokeText("You escaped the tomb.",
200,160),K.strokeText("Krun is free now.",215,200))}Ja=a;a=Date.now()-a;K.fillRect(0,C*A,B*z,10);K.strokeText(a.toString(10),10,C*A+10);K.strokeText("Lifes left: "+v.ja.toString(10),B*z/2,C*A+10)}function fb(a,c,e){for(var b=K.createImageData(c,e),f=0;f<4*c*e;f++)b.data[f]=a[f];return b}
function gb(a){a=hb(a);G=[];G.s=a.map_size_x;G.Z=a.map_size_y;xa=[];for(var c in a.layers)xa[c]=Ma(a.layers[c]);ya=Array(a.rooms.length);var e=a.rooms;for(c=0;c<a.rooms.length;c++){var b=[];b.Pa=e[c].name;b.t=e[c].x0;b.C=e[c].y0;b.W=e[c].x1;b.da=e[c].y1;var f=e[c].bitmap;if(f==m)b.D=m;else{var f=Ma(f),g=b.W-b.t,k=b.da-b.C,s=document.createElement("canvas");s.width=g;s.height=k;for(var p=K.createImageData(s.width,s.height),q=0;q<g;q++)for(var l=0;l<k;l++){var h=4*(q+l*g);0==(f[Math.floor(q/8)+l*Math.ceil(g/
8)]&1<<(q&7))?(p.data[h+0]=0,p.data[h+1]=0,p.data[h+2]=0,p.data[h+3]=0):(p.data[h+0]=0,p.data[h+1]=0,p.data[h+2]=0,p.data[h+3]=255)}s.getContext("2d").putImageData(p,0,0);b.D=[];b.D.l=s;b.D.Ga=f}ya[c]=b}Aa=Array(a.tiles.length);for(c=0;c<a.tiles.length;c++)Aa[c]=fb(Ma(a.tiles[c]),z,A);Ea=[];for(var n in a.named_tiles)Ea[n]=a.named_tiles[n];Ba=[];for(var x in a.anims){e=a.anims[x];n=e.steps;c={};c.aa=n[0][0];b=[];f=n.length;for(g=0;g<f;g++)k={},k.Aa=n[g][0],k.La=n[g][1],b.push(k);c.S=b;c.u=0;c.N=0;
c.ia=Boolean(e.fIsOneshot);n=m;b=e.fnCallbackEnd;b!=m&&""!=b&&(n=Ra[b],n==m&&window.alert("Error in level data! Unknown animation end action:"+b));c.Y=n;Ba[x]=c}G.sa=[];for(x in a.collision){e=a.collision[x];n=m;b=e.action;b!=m&&""!=b&&(n=Xa[b],n==m&&window.alert("Error in level data! Unknown action:"+b));b=Array(e.maps.length);for(c=0;c<e.maps.length;c++)f=[],g=e.maps[c],f.type=g[0],f.q=g[1],f.r=g[2],f.J=g[3],f.K=g[4],b[c]=f;c=[];c.action=n;c.ua=b;c.Ha=e.collision_fall;c.Ia=e.collision_jump;c.Ja=
e.collision_stand;c.Ka=e.collision_walk;G.sa[x]=c}G.R=[];for(c=0;c<a.start.length;c++)x=[],x.x=a.start[c][0],x.y=a.start[c][1],G.R.push(x);G.Ma=a.action[0];G.la=[];for(var P in a.gold2target)G.la[P]=a.gold2target[P];G.na=[];for(var F in a.switch2door)G.na[F]=a.switch2door[F];G.ma=[];for(var da in a.respawn)G.ma[da]=a.respawn[da];return d}
function ib(a){for(var c=hb(a),e=Array(c.walkjump.sprites.length),b=0;b<c.walkjump.sprites.length;b++){var f=fb(Ma(c.walkjump.sprites[b]),32,32);e[b]=f}v.a=[];v.a.pa=[0];v.a.T=[5];v.a.ga=[4];v.a.ha=[9];v.a.qa=[0,1,2,1,0,3,4,3];v.a.ra=[5,6,7,6,5,8,9,8];v.a.fa=[10,11,10,12];v.a.oa=[13];a=Array(c.life_lost.sprites.length);for(b=0;b<c.life_lost.sprites.length;b++)f=fb(Ma(c.life_lost.sprites[b]),32,32),a[b]=f;c=[0,1,2,2,1];Fa=[];b=document.createElement("canvas");b.width=32;b.height=32;f=b.getContext("2d");
H=[];H.M=d;H.j=0;H.f=0;H.l=b;H.n=f;H.X=e;H.h=v.a.T;H.I=v.a.T[0];H.m=0;H.i=1;H.o=0;Fa.push(H);f.putImageData(H.X[H.I],0,0);e=document.createElement("canvas");e.width=32;e.height=32;b=e.getContext("2d");J=[];J.M=r;J.j=0;J.f=0;J.l=e;J.n=b;J.X=a;J.h=c;J.I=c[0];J.m=0;J.i=3;J.o=0;Fa.push(J);b.putImageData(J.X[J.I],0,0);return d}
function db(){v.e=oa;var a=G.R[0].x*z+v.b.q+(v.b.J-v.b.q)/2,c=G.R[0].y*A+v.b.r+(v.b.K-v.b.r)/2;H.M=d;H.j=a;H.f=c;H.h=v.a.T;H.I=-1;H.m=0;H.i=1;H.o=0;J.M=r;J.I=J.h[0];J.m=0;J.i=3;J.o=0;t=ba;v.g=ga;v.c=0}
function jb(){t=aa;Ca=[];Da=[];var a=(Math.ceil(B/D)+1)*(Math.ceil(C/E)+1);N=Array(2);for(var c=["ground","objects"],e=0;e<c.length;e++){for(var b=c[e],f=Array(a),g=0;g<a;g++){var k=document.createElement("canvas");k.width=z*D;k.height=A*E;var s=k.getContext("2d");f[g]=[k,s]}b=xa[b];s=b.length;k=Array(s);for(g=0;g<s;g++){var p=b[g];if(p in Ba){var q;q=Ca;for(var l=m,h=q.length,n=0;n<h;n++)if(q[n].ca==p){l=n;break}q=l;q==m?(p=Pa(Ba[p],m,p),Ca.push(p)):p=Ca[q];k[g]=p}}g=[];g.k=b;g.ka=f;g.L=k;g.ea=[];
N[e]=g}Q=Math.ceil(G.s/D);Ha=Math.ceil(G.Z/E);O=Array(Q*Ha);R=new Uint8Array(Math.ceil(G.s*G.Z/8));for(g=0;g<R.length;g++)R[g]=255;N[1].ea.push(H);N[1].ea.push(J);a=Ua();S=a[0];T=a[1];for(g=0;g<O.length;g++)O[g]=m;e=Math.floor(S/(z*D));a=Math.floor(T/(A*E));f=e+Math.ceil(B/D)+1;g=a+Math.ceil(C/E)+1;for(b=0;a<g;a++)for(c=e;c<f;c++)O[c+Q*a]=[N[0].ka[b],N[1].ka[b]],b++;e=Math.floor(S/z);a=Math.floor(T/A);f=e+B+1;for(g=a+C+1;a<g;a++)for(c=e;c<f;c++)Sa(c,a);L=[];L.l=document.createElement("canvas");L.l.width=
G.s;L.l.height=G.Z;L.n=L.l.getContext("2d");L.n.fillStyle="#000000";L.n.fillRect(0,0,L.l.width,L.l.height);db();Ta();Ja=0;eb()}function kb(){}function lb(){Ia=d}
window.game_run=function(){if(!window.requestAnimationFrame)for(var a=[window.webkitRequestAnimationFrame,window.mozRequestAnimationFrame,window.oRequestAnimationFrame,window.msRequestAnimationFrame],c=a.length,e=0;e<c;e++){var b=a[e];if("function"==typeof b){window.requestAnimationFrame=b;break}}window.requestAnimationFrame&&(A=z=32,Ia=r,document.addEventListener("blur",lb,r),Ga=document.getElementById("myCanvas"),K=Ga.getContext("2d"),K.font="10px serif",K.fillStyle="black",K.strokeStyle="white",
B=Math.floor(Ga.width/z),C=Math.floor(Ga.height/A),E=D=8,document.addEventListener("keydown",mb,d),document.addEventListener("keyup",nb,d),document.addEventListener("touchstart",ob,r),document.addEventListener("touchend",pb,r),document.addEventListener("touchcancel",qb,r),document.addEventListener("touchmove",rb,r),t=1,a=new sb,tb(a,"aztec_pig_level1.json",gb),tb(a,"player_sprite.json",ib),a.wa=jb,a.$=kb,a.O=0,ub(a))};var bb=1,cb=2,X=4,Y=8,W=16,Z=0;function vb(){t==ca&&t==ca&&(t=ba,window.requestAnimationFrame(eb),Ja=0)};function mb(a){var c=r;0==a.charCode&38==a.keyCode?(Z|=bb,c=d):0==a.charCode&37==a.keyCode?(Z|=X,c=d):0==a.charCode&40==a.keyCode?(Z|=cb,c=d):0==a.charCode&39==a.keyCode?(Z|=Y,c=d):0==a.charCode&17==a.keyCode?(Z|=W,c=d):0==a.charCode&13==a.keyCode&&(Z|=W,c=d);c==d&&vb()}
function nb(a){var c=r;0==a.charCode&38==a.keyCode?(Z&=255-bb,c=d):0==a.charCode&37==a.keyCode?(Z&=255-X,c=d):0==a.charCode&40==a.keyCode?(Z&=255-cb,c=d):0==a.charCode&39==a.keyCode?(Z&=255-Y,c=d):0==a.charCode&17==a.keyCode?(Z&=255-W,c=d):0==a.charCode&13==a.keyCode&&(Z&=255-W,c=d);c==d&&vb()};var $=[];$.G=[];$.G.p=m;$.G.Fa=m;$.G.Na=m;$.H=[];$.H.p=m;$.H.Fa=m;$.H.Na=m;function ob(a){for(var c=r,e=0;e<a.changedTouches.length;e++){var b=a.changedTouches[e].identifier;a.changedTouches[e].pageX<document.documentElement.clientWidth/2?$.G.p==m&&($.G.p=b,Z|=W,c=d):(b=$.H,b.p==m&&(b.p=a.changedTouches[e].identifier,b.Da=a.changedTouches[e].pageX,b.Ea=a.changedTouches[e].pageY,c=d))}c==d&&vb();a.preventDefault()}
function pb(a){for(var c=r,e=0;e<a.changedTouches.length;e++){var b=a.changedTouches[e].identifier;b==$.G.p?($.G.p=m,Z&=255-W,c=d):b==$.H.p&&($.H.p=m,Z&=255-bb-cb-X-Y,c=d)}c==d&&vb();a.preventDefault()}function qb(a){pb(a)}
function rb(a){for(var c=r,e=0;e<a.changedTouches.length;e++){var b=$.H;if(a.changedTouches[e].identifier==b.p){var f=a.changedTouches[e].pageX,g=a.changedTouches[e].pageY,e=f-b.Da,k=g-b.Ea;if(16<=Math.abs(e)||16<=Math.abs(k))b.Da=f,b.Ea=g,b=m,b=Math.atan2(k,e),b=b<-(7*Math.PI/8)?6:b<-(5*Math.PI/8)?7:b<-(3*Math.PI/8)?0:b<-(1*Math.PI/8)?1:b<1*Math.PI/8?2:b<3*Math.PI/8?3:b<5*Math.PI/8?4:b<7*Math.PI/8?5:6,Z&=255-bb-cb-X-Y,0==b?(Z|=bb,c=d):2==b?(Z|=Y,c=d):4==b?(Z|=cb,c=d):6==b&&(Z|=X,c=d);break}}c==d&&
vb();a.preventDefault()};function sb(){this.v=m;this.Q=[];this.O=0;this.$=this.wa=m}function tb(a,c,e){var b={};b.ya=c;b.xa="application/json";b.va=e;b.Ra=m;a.Q.push(b)}function hb(a){var c=m,c=a.Q[a.O].xa;return c="image/png"==c?a.v:"application/json"==c?JSON.parse(a.v.responseText):a.v.responseText}
function ub(a){if(a.O<a.Q.length){var c=a.Q[a.O],e=c.xa;if("image/png"==e){var b=new Image;b.onload=function(){wb(a)};b.onerror=function(){a.$(a)};a.v=b;b.src=c.ya}else b=new XMLHttpRequest,b.overrideMimeType(e),b.open("GET",c.ya,d),b.onreadystatechange=function(){4==a.v.readyState&&("200"==a.v.status?wb(a):a.$(a))},a.v=b,b.send()}else a.v=m,a.wa(a)}function wb(a){var c=a.Q[a.O],e=d;c.va!=m?e=c.va(a):c.Qa=hb(a);e==d?(a.O++,ub(a)):a.$(a)};
